(self.webpackChunkalecture=self.webpackChunkalecture||[]).push([[256],{5256:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>b});var n=a(2309),l=a(2545),s=a(9250),r=a(8678),c=a(2951),o=a(7753);const i=(0,o.Z)("div",{target:"enhg4lt1"})({name:"l986mw",styles:"display:flex;flex-wrap:wrap;height:calc(100vh - 38px);flex-flow:column"}),h=(0,o.Z)("header",{target:"enhg4lt0"})({name:"1ezwwi6",styles:"height:64px;display:flex;width:100%;--saf-0:rgba(var(--sk_foreground_low, 29, 28, 29), 0.13);box-shadow:0 1px 0 var(--saf-0);padding:20px 16px 20px 20px;font-weight:bold;align-items:center;& .header-right{display:flex;flex:1;justify-content:flex-end;align-items:center;}"});var u=a(3564),d=a(8667),p=a(9669),g=a.n(p),m=a(7294),f=a(5977),w=a(8100);const b=()=>{const{workspace:e,channel:t}=(0,f.UO)(),{data:a}=(0,w.ZP)("/api/users",u.Z),[o,p,b]=(0,r.Z)(""),{data:k}=(0,w.ZP)(`/api/workspaces/${e}/channels/${t}`,u.Z),{data:x,mutate:C,revalidate:Z,setSize:_}=(0,w.g_)((a=>`/api/workspaces/${e}/channels/${t}/chats?perPage=20&page=${a+1}`),u.Z),{data:v}=(0,w.ZP)(a?`/api/workspaces/${e}/channels/${t}/members`:null,u.Z),[E]=(0,c.Z)(e),$=0===x?.[0]?.length||x&&x[x.length-1]?.length<20||!1,y=(0,m.useRef)(null),[S,T]=(0,m.useState)(!1),B=(0,m.useCallback)((n=>{if(n.preventDefault(),console.log(o),o?.trim()&&x&&k){const n=o;C((e=>(e?.[0].unshift({id:(x[0][0]?.id||0)+1,content:n,UserId:a.id,User:a,ChannelId:k.id,Channel:k,createdAt:new Date}),e)),!1).then((()=>{b(""),y.current?.scrollToBottom()})),g().post(`/api/workspaces/${e}/channels/${t}/chats`,{content:o}).then((()=>{Z()})).catch(console.error)}}),[o,x,a,k,e,t]),I=(0,m.useCallback)((e=>{e.Channel.name===t&&e.UserId!==a?.id&&C((t=>(t?.[0].unshift(e),t)),!1).then((()=>{y.current&&y.current.getScrollHeight()<y.current.getClientHeight()+y.current.getScrollTop()+150&&(console.log("scrollToBottom!",y.current?.getValues()),setTimeout((()=>{y.current?.scrollToBottom()}),50))}))}),[t,a]);(0,m.useEffect)((()=>(E?.on("message",I),()=>{E?.off("message",I)})),[E,I]),(0,m.useEffect)((()=>{1===x?.length&&y.current?.scrollToBottom()}),[x]);const P=(0,m.useCallback)((()=>{T(!0)}),[]),U=(0,m.useCallback)((()=>{T(!1)}),[]);if(!a||!a)return null;const z=(0,d.Z)(x?x.flat().reverse():[]);return m.createElement(i,null,m.createElement(h,null,m.createElement("span",null,"#",t),m.createElement("div",{className:"header-right"},m.createElement("span",null,v?.length),m.createElement("button",{onClick:P,className:"c-button-unstyled p-ia__view_header__button","aria-label":"Add people to #react-native","data-sk":"tooltip_parent",type:"button"},m.createElement("i",{className:"c-icon p-ia__view_header__button_icon c-icon--add-user","aria-hidden":"true"})))),m.createElement(l.Z,{chatSections:z,scrollRef:y,setSize:_,isReachingEnd:$}),m.createElement(n.Z,{chat:o,onChangeChat:p,onSubmitForm:B}),m.createElement(s.Z,{show:S,onCloseModal:U,setShowInviteChannelModal:T}))}}}]);