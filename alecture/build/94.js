(self.webpackChunkalecture=self.webpackChunkalecture||[]).push([[94],{3094:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>k});var n=r(2309),a=r(2545),l=r(8678),c=r(2951),s=r(7753);const o=(0,s.Z)("div",{target:"enpw7kx1"})({name:"l986mw",styles:"display:flex;flex-wrap:wrap;height:calc(100vh - 38px);flex-flow:column"}),i=(0,s.Z)("header",{target:"enpw7kx0"})({name:"1c17pcy",styles:"height:64px;display:flex;width:100%;--saf-0:rgba(var(--sk_foreground_low, 29, 28, 29), 0.13);box-shadow:0 1px 0 var(--saf-0);padding:20px 16px 20px 20px;font-weight:bold;align-items:center;& img{margin-right:5px;}"});var u=r(3564),d=r(8667),p=r(9669),h=r.n(p),m=r(7294),g=r(6182),f=r.n(g),w=r(5977),x=r(8100);const k=()=>{const{workspace:e,id:t}=(0,w.UO)(),{data:r}=(0,x.ZP)(`/api/workspaces/${e}/users/${t}`,u.Z),{data:s}=(0,x.ZP)("/api/users",u.Z),[p,g,k]=(0,l.Z)(""),{data:Z,mutate:v,revalidate:b,setSize:E}=(0,x.g_)((r=>`/api/workspaces/${e}/dms/${t}/chats?perPage=20&page=${r+1}`),u.Z),[S]=(0,c.Z)(e),C=0===Z?.[0]?.length||Z&&Z[Z.length-1]?.length<20||!1,$=(0,m.useRef)(null),T=(0,m.useCallback)((n=>{if(n.preventDefault(),console.log(p),p?.trim()&&Z){const n=p;v((e=>(e?.[0].unshift({id:(Z[0][0]?.id||0)+1,content:n,SenderId:s.id,Sender:s,ReceiverId:r.id,Receiver:r,createdAt:new Date}),e)),!1).then((()=>{k(""),$.current?.scrollToBottom()})),h().post(`/api/workspaces/${e}/dms/${t}/chats`,{content:p}).then((()=>{b()})).catch(console.error)}}),[p,Z,s,r,e,t]),y=(0,m.useCallback)((e=>{e.SenderId===Number(t)&&s.id!==Number(t)&&v((t=>(t?.[0].unshift(e),t)),!1).then((()=>{$.current&&$.current.getScrollHeight()<$.current.getClientHeight()+$.current.getScrollTop()+150&&(console.log("scrollToBottom!",$.current?.getValues()),setTimeout((()=>{$.current?.scrollToBottom()}),50))}))}),[]);if((0,m.useEffect)((()=>(S?.on("dm",y),()=>{S?.off("dm",y)})),[S,y]),(0,m.useEffect)((()=>{1===Z?.length&&$.current?.scrollToBottom()}),[Z]),!r||!s)return null;const R=(0,d.Z)(Z?Z.flat().reverse():[]);return m.createElement(o,null,m.createElement(i,null,m.createElement("img",{src:f().url(r.email,{s:"24px",d:"retro"}),alt:r.nickname}),m.createElement("span",null,r.nickname)),m.createElement(a.Z,{chatSections:R,scrollRef:$,setSize:E,isReachingEnd:C}),m.createElement(n.Z,{chat:p,onChangeChat:g,onSubmitForm:T}))}}}]);